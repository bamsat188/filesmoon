<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Video Streaming</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
}
#videos{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:10px;
  padding:10px;
}
.card{
  background:#111;
  cursor:pointer;
}
.thumb{
  width:100%;
  padding-top:56%;
  background-size:cover;
  background-position:center;
}
.info{
  padding:6px;
}
.title{
  font-size:13px;
  line-height:1.3;
}
#pagination{
  text-align:center;
  padding:15px;
}
#pagination a{
  color:#0af;
  text-decoration:none;
}
#playerBox{
  display:none;
  position:fixed;
  inset:0;
  background:#000;
  z-index:999;
}
#player{
  width:100%;
  height:100%;
  border:0;
}
#playerOverlay{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.6);
  z-index:1000;
  cursor:pointer;
}
#playerOverlay span{
  background:#f00;
  padding:12px 18px;
  font-weight:bold;
}
#videoInfo{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  background:linear-gradient(transparent,rgba(0,0,0,.8));
  padding:10px;
  display:none;
}
</style>
</head>

<body>

<div id="videos"></div>
<div id="pagination"></div>

<div id="playerBox">
  <iframe id="player" allowfullscreen></iframe>

  <div id="playerOverlay">
    <span>KLIK UNTUK LANJUTKAN</span>
  </div>

  <div id="videoInfo">
    <div id="videoTitle"></div>
    <div id="videoDate"></div>
  </div>
</div>

<script>
/* ===================== CONFIG ===================== */
const API = "https://zone.filesmoon.site/api/asupan1"; // API SENDIRI

const DIRECT_LINKS = [
  "https://site1.com"
];

const AD_DELAY = 45000;
const HOME_PER_PAGE = 8;
const STREAM_RECOMMEND = 6;

let FILES = [];
let adInterval = null;

/* ===================== ELEMENT ===================== */
const list = document.getElementById("videos");
const pagination = document.getElementById("pagination");
const playerBox = document.getElementById("playerBox");
const player = document.getElementById("player");
const overlay = document.getElementById("playerOverlay");
const videoInfo = document.getElementById("videoInfo");
const videoTitle = document.getElementById("videoTitle");
const videoDate = document.getElementById("videoDate");

/* ===================== IKLAN ===================== */
function getRandomDirectLink(){
  return DIRECT_LINKS[Math.floor(Math.random() * DIRECT_LINKS.length)];
}

function fireAd(){
  const now = Date.now();
  const last = parseInt(localStorage.getItem("last_ad") || "0");
  if(now - last >= AD_DELAY){
    localStorage.setItem("last_ad", now);
    window.open(getRandomDirectLink(), "_blank");
  }
}

function startAdOverlayTimer(){
  clearInterval(adInterval);
  adInterval = setInterval(()=>{
    overlay.style.display = "flex";
  }, AD_DELAY);
}

/* ===================== CARD ===================== */
function renderCard(v){
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <div class="thumb" style="background-image:url('${v.thumbnail || ""}')"></div>
    <div class="info">
      <p class="title">${v.title || "Untitled Video"}</p>
    </div>
  `;
  card.onclick = () => {
    fireAd();
    location.hash = `/e/${v.id}`;
    setTimeout(handleRoute,0);
  };
  list.appendChild(card);
}

/* ===================== ROUTER ===================== */
function handleRoute(){
  const m = location.hash.match(/#\/e\/([\w]+)/);
  if(!m) return;

  const video = FILES.find(v => v.id === m[1]);
  if(!video) return;

  player.src = video.embed;
  playerBox.style.display = "block";
  overlay.style.display = "flex";

  videoInfo.style.display = "block";
  videoTitle.textContent = video.title || "-";
  videoDate.textContent = video.uploaded || "-";

  list.innerHTML = "";
  FILES.sort(()=>0.5 - Math.random())
       .slice(0, STREAM_RECOMMEND)
       .forEach(renderCard);

  startAdOverlayTimer();
}

/* ===================== OVERLAY ===================== */
overlay.onclick = () => {
  fireAd();
  overlay.style.display = "none";
  startAdOverlayTimer();
};

/* ===================== INIT ===================== */
const PAGE = parseInt(new URLSearchParams(location.search).get("page") || "1");

fetch(API)
.then(r => r.json())
.then(data => {
  FILES = data.videos || [];

  if(location.hash){
    handleRoute();
  }else{
    FILES.slice((PAGE-1)*HOME_PER_PAGE, PAGE*HOME_PER_PAGE)
         .forEach(renderCard);

    if(PAGE*HOME_PER_PAGE < FILES.length){
      pagination.innerHTML =
        `<a href="?page=${PAGE+1}">Lihat video lainnya â†’</a>`;
    }
  }
})
.catch(()=>{
  list.innerHTML =
    "<p style='color:red;text-align:center'>Tidak dapat memuat video.</p>";
});

window.addEventListener("hashchange", handleRoute);
</script>

</body>
</html>
